CUDA_VISIBLE_DEVICES=0 python create_datastore.py /media/hdd1/pam/mt/data/joint_multi_domain/medical/adaptive_retrieval/using_train_set/datastore_set/data-bin/     --dataset-impl mmap     --task translation     --valid-subset train     --path /media/hdd1/pam/mt/models/wmt19.de-en/wmt19.de-en.pt     --max-tokens 4096 --skip-invalid-size-inputs-valid-test     --decoder-embed-dim 1024 --dstore-size 5134498 --dstore-mmap /media/hdd1/pam/mt/data/joint_multi_domain/medical/adaptive_retrieval/using_train_set/datastore_set/

screen -dmS train_datastore_pca_subtitles sh -c 'export LD_PRELOAD=/home/pam/anaconda3/lib/libmkl_core.so:/home/pam/anaconda3/lib/libmkl_sequential.so; CUDA_VISIBLE_DEVICES=2 python3 train_datastore.py --dstore_mmap=/media/hdd1/pam/mt/data/joint_multi_domain/subtitles/datastore_32/ --dstore_size=153604142 --faiss_index=/media/hdd1/pam/mt/data/joint_multi_domain/subtitles/datastore_32/pca/pca_256_knn_incex --pca=256; exec bash'

screen -dmS save_neighors_subtitles sh -c 'export LD_PRELOAD=/home/pam/anaconda3/lib/libmkl_core.so:/home/pam/anaconda3/lib/libmkl_sequential.so; CUDA_VISIBLE_DEVICES=0 python3 save_neighors.py --dstore_size=153604142 --dstore_mmap=/media/hdd1/pam/mt/data/joint_multi_domain/subtitles/datastore_32/ --faiss_index=/media/hdd1/pam/mt/data/joint_multi_domain/subtitles/datastore_32/knn_index.trained --save-dir=/media/hdd1/pam/mt/data/joint_multi_domain/subtitles/datastore_32/pruning_neighbors/; exec bash'


export LD_PRELOAD=/home/pam/anaconda3/lib/libmkl_def.so:/home/pam/anaconda3/lib/libmkl_avx2.so:/home/pam/anaconda3/lib/libmkl_core.so:/home/pam/anaconda3/lib/libmkl_intel_lp64.so:/home/pam/anaconda3/lib/libmkl_intel_thread.so:/home/pam/anaconda3/lib/libiomp5.so
CUDA_VISIBLE_DEVICES=0 python3 save_adaptive_retrieval_features.py /media/hdd1/pam/mt/data/joint_multi_domain/koran/adaptive_retrieval/data-bin/ --task=translation --path /media/hdd1/pam/mt/models/wmt19.de-en/wmt19.de-en.pt --valid-subset=train  --batch-size=1 --source-lang de --target-lang en --scoring sacrebleu --max-tokens 4096 --tokenizer moses --remove-bpe --model-overrides "{'load_knn_datastore': True, 'use_knn_datastore': True, 'dstore_filename': '/media/hdd1/pam/mt/data/joint_multi_domain/koran/datastore_32/', 'dstore_size': 524374, 'dstore_fp16': False, 'k': 8, 'probe': 32, 'faiss_metric_type': 'l2', 'use_gpu_to_search': False, 'move_dstore_to_mem': True, 'no_load_keys': True,'knn_lambda_type': 'fix', 'knn_lambda_value': .6, 'knn_temperature_type': 'fix', 'knn_temperature_value': 100, 'adaptive_retrieval_features_path': '/media/hdd1/pam/mt/data/joint_multi_domain/koran/adaptive_retrieval/'}"

python3 adaptive_retrieval/train_adaptive_retrieval.py --train_file=/media/hdd1/pam/mt/data/joint_multi_domain/koran/adaptive_retrieval/features --val_file=/media/hdd1/pam/mt/data/joint_multi_domain/koran/adaptive_retrieval/features_val --output-dir=/media/hdd1/pam/mt/data/joint_multi_domain/koran/adaptive_retrieval/

CUDA_VISIBLE_DEVICES=0 python3 fairseq_cli/generate.py /media/hdd1/pam/mt/data/joint_multi_domain/medical/data-bin/    --gen-subset test     --path /media/hdd1/pam/mt/models/wmt19.de-en/wmt19.de-en.pt     --beam 5 --source-lang de --target-lang en     --scoring sacrebleu     --max-tokens 4096 --tokenizer moses --remove-bpe  --batch-size=8 --quiet

CUDA_VISIBLE_DEVICES=1 python3 generate_knnmt.py /media/hdd1/pam/mt/data/joint_multi_domain/medical/data-bin/ --path /media/hdd1/pam/mt/models/wmt19.de-en/wmt19.de-en.pt --arch transformer_wmt19_de_en_with_datastore --gen-subset=test --beam 5 --batch-size=16 --source-lang de --target-lang en --scoring sacrebleu --max-tokens 4096 --tokenizer moses --remove-bpe --model-overrides "{'load_knn_datastore': True, 'use_knn_datastore': True, 'dstore_filename': '/media/hdd1/pam/mt/data/joint_multi_domain/medical/datastore_32/pca/pca_256_', 'dstore_size': 6903141, 'dstore_fp16': False, 'k': 8, 'probe': 32, 'faiss_metric_type': 'l2', 'use_gpu_to_search': False, 'move_dstore_to_mem': True, 'no_load_keys': True,'knn_lambda_type': 'fix', 'knn_lambda_value': 0.8, 'knn_lambda_use_conf_ent': False, 'knn_temperature_type': 'fix', 'knn_temperature_value': 10,}" --quiet